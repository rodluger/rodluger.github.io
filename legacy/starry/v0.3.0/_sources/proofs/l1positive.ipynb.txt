{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Positive semi-definite surface maps\n",
    "\n",
    "#### Derivation of the positive semi-definite condtion for $l = 1$ maps"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "If we denote our map coefficients by $\\mathbf{y} = \\{ \\mathbf{y_0}, \\mathbf{y_1}, \\mathbf{y_2}, \\mathbf{y_3} \\}$, the specific intensity of a map of degree $l_\\mathrm{max} = 1$ as a function of $x$ and $y$ is given by\n",
    "\n",
    "\\begin{align}\n",
    "    I(x, y) &= \\mathbf{y_0} Y_{0,0} + \\mathbf{y_1} Y_{1,-1} + \\mathbf{y_2} Y_{1,0} + \\mathbf{y_3} Y_{1,1} \\\\\n",
    "            &= \\mathbf{y_0} \\sqrt{\\frac{1}{4\\pi}}\n",
    "             + \\mathbf{y_1} \\sqrt{\\frac{3}{4\\pi}} y\n",
    "             + \\mathbf{y_2} \\sqrt{\\frac{3}{4\\pi}} \\sqrt{1 - x^2 - y^2}\n",
    "             + \\mathbf{y_3} \\sqrt{\\frac{3}{4\\pi}} x\n",
    "\\end{align}\n",
    "\n",
    "To ensure the map is positive semi-definite everywhere, the minimum value of $I(x, y)$ must be $\\ge 0$. We therefore differentiate it with respect to $x$ and $y$ and set the derivatives to zero to obtain two constraints on the location of the extrema:\n",
    "\n",
    "\\begin{align}\n",
    "    \\frac{\\mathrm{d}I}{\\mathrm{d}x} = \\sqrt{\\frac{3}{4\\pi}}\\left(-\\frac{\\mathbf{y_2} x}{\\sqrt{1 - x^2 - y^2}} + \\mathbf{y_3}\\right) = 0\n",
    "\\end{align}\n",
    "\n",
    "and\n",
    "\n",
    "\\begin{align}\n",
    "    \\frac{\\mathrm{d}I}{\\mathrm{d}y} = \\sqrt{\\frac{3}{4\\pi}}\\left(-\\frac{\\mathbf{y_2} y}{\\sqrt{1 - x^2 - y^2}} + \\mathbf{y_1}\\right) = 0\n",
    "\\end{align}\n",
    "\n",
    "so the values of $x$ and $y$ at the extrema satisfy\n",
    "\n",
    "\\begin{align}\n",
    "    \\tag{1}\n",
    "    \\mathbf{y_2} x &= \\mathbf{y_3}\\sqrt{1 - x^2 - y^2}\n",
    "\\end{align}\n",
    "\n",
    "and\n",
    "\n",
    "\\begin{align}\n",
    "    \\tag{2}\n",
    "    \\mathbf{y_2} y = \\mathbf{y_1}\\sqrt{1 - x^2 - y^2}\n",
    "\\end{align}\n",
    "\n",
    "Rearranging (1),\n",
    "\n",
    "\\begin{align}\n",
    "    x^2 &= \\frac{\\mathbf{y_3}^2}{(\\mathbf{y_2}^2 + \\mathbf{y_3}^2)}(1 - y^2).\n",
    "\\end{align}\n",
    "\n",
    "Plugging into (2) and rearranging, we can solve for $y$:\n",
    "\n",
    "\\begin{align}\n",
    "y = \\pm \\frac{\\mathbf{y_1}}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}}\n",
    "\\end{align}\n",
    "\n",
    "and then for $x$:\n",
    "\n",
    "\\begin{align}\n",
    "x = \\pm \\frac{\\mathbf{y_3}}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}}\n",
    "\\end{align}\n",
    "\n",
    "Finally, plugging these back into the equation for $I(x, y)$, we get the value of the specific intensity at the extrema:\n",
    "\n",
    "\\begin{align}\n",
    "    I(x, y) &= \\mathbf{y_0} \\sqrt{\\frac{1}{4\\pi}}\n",
    "             \\pm \\sqrt{\\frac{3}{4\\pi}} \\frac{\\mathbf{y_1^2}}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}}\n",
    "             + \\mathbf{y_2} \\sqrt{\\frac{3}{4\\pi}} \\frac{\\mathbf{y_2^2}}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}}\n",
    "             \\pm \\sqrt{\\frac{3}{4\\pi}} \\frac{\\mathbf{y_3^2}}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}} \\\\\n",
    "             &= \\sqrt{\\frac{1}{4\\pi}} \\left( \\mathbf{y_0} \\pm \\sqrt{3} \\frac{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}{\\sqrt{\\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2}} \\right)\n",
    "\\end{align}\n",
    "\n",
    "By inspection, the minimum value corresponds to the solution with the minus sign. So the necessary and sufficient condition for $I(x,y) \\ge 0$ is\n",
    "\n",
    "\\begin{align}\n",
    "    \\mathbf{y_1}^2 + \\mathbf{y_2}^2 + \\mathbf{y_3}^2 \\le \\frac{\\mathbf{y_0}^2}{3}\n",
    "\\end{align}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "â– "
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
