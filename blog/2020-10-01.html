<!DOCTYPE html>
<html lang="en">

<head>

     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta name="description" content="This is a continuation of the <a href='2020-09-24.html'>previous post</a>, in which we implemented a very slow, inefficient, and numerically unstable Gaussian process for stellar light curves. In this post I'll discuss how to compute the GP kernel analytically and show how to use this GP to learn about star spot properties from stellar light curves.">
     <meta name="author" content="Rodrigo Luger">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     <title>Interpretable GPs for stellar rotation (Part 2)</title>

     <link rel="stylesheet" href="../css/bootstrap.min.css">
     <link rel="stylesheet" href="../css/fontawesome.css">

     <!-- Main css -->
     <link rel="stylesheet" href="../css/custom.css">
     <link rel="stylesheet" href="static/custom.css">

     <script src='https://polyfill.io/v3/polyfill.min.js?features=es6'>
     </script>
     <script id='MathJax-script' async src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'>
     </script>

     <!-- Global site tag (gtag.js) - Google Analytics -->
     <script async src="https://www.googletagmanager.com/gtag/js?id=UA-47070068-1"></script>
     <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());

     gtag('config', 'UA-47070068-1');
     </script>

     <!-- Code syntax highlighting -->
     <link rel="stylesheet" href="static/highlight/styles/default.css">
     <script src="static/highlight/highlight.pack.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

     <!-- PRE LOADER -->

     <div class="preloader">
          <div class="spinner">
               <div class="dot1"></div>
               <div class="dot2"></div>
          </div>
     </div>

     <!-- Navigation section  -->

     <div class="navbar navbar-default navbar-static-top" role="navigation">
          <div class="container">

               <div class="navbar-header">
                    <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                         <span class="icon icon-bar"></span>
                         <span class="icon icon-bar"></span>
                         <span class="icon icon-bar"></span>
                    </button>
                    <a href="../index.html" class="navbar-brand">
                         <span class="avatar">
                              <img src="../images/rodrigo-luger-avatar.jpg">
                         </span>
                    </a>
               </div>
               <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                         <li class="active"><a href="../index.html">home</a></li>
                         <li><a href="../about.html">about</a></li>
                         <li><a href="https://github.com/rodluger/cv/raw/master-pdf/luger_cv.pdf">cv</a></li>
                         <li><a href="index.html">blog</a></li>
                    </ul>
               </div>

          </div>
     </div>

     <!-- Blog Single Post Section -->

     <section id="blog-single-post">
          <div class="container">
               <div class="row">

                    <div class="col-md-offset-1 col-md-10 col-sm-12">
                         <div class="blog-single-post-thumb">
                              <div class="blog-post-image">
                                   <img src="images/starry-process.jpg" class="img-responsive" alt="Blog Image">
                              </div>

                              <div class="blog-post-title">
                                   <h3>Interpretable GPs for stellar rotation (Part 2)</h3>
                              </div>

                              <div class="blog-post-format">
                                   <span><a href="#"><img src="../images/rodrigo-luger-avatar.jpg" class="img-responsive img-circle"
                                                  style="margin-right: 8px;">Rodrigo Luger</a></span>
                                   <span><i class="far fa-calendar"
                                             style="margin-right:5px; color: #666;"></i>October 1 2020</span>
                              </div>

                              <div class="blog-post-des">
                                   <p>This is a continuation of the <a href='2020-09-24.html'>previous post</a>, in which we implemented a very slow, inefficient, and numerically unstable Gaussian process for stellar light curves. In this post I'll discuss how to compute the GP kernel analytically and show how to use this GP to learn about star spot properties from stellar light curves.</p><p><h1>Demo</h1></p><p>Before I discuss <span style='font-style:italic;'>how</span> any of this works, let's cut to the chase. <a href='#Figure1'>Figure 1</a> below shows a demo of a <span style='font-style:italic;'>starry process</span>, a Gaussian process whose hyperparameters correspond to physical properties of the distribution of star spots on the stellar surface.</p>
                <div id="Figure1Modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body full-width">
                                
                <div class="blog-image-container full-width">
                <video width='100%' autoplay muted loop>
                    <source src='images/starry-process.mp4' type='video/mp4'>
                    Your browser does not support the video tag.
                </video>
                </div>
                                <p>
                                    <span style="font-weight: 600; padding-right: 0.5em;">Figure 1</span>
                                    <span>A video demo of a <a href='https://github.com/rodluger/starry_process'>starry process</a>. The kernel of the Gaussian process is a function of six hyperparameters that control the mean and standard deviation of the spot size, latitude, and contrast distributions (top panels). The bottom panels show random samples from the GP on the surface of the star (in a Mollweide projection) and in flux space. Line colors correspond to different stellar inclinations with respect to the line of sight. Because the kernel is an analytic function of the hyperparameters, drawing samples and computing marginal likelihoods with a <a href='https://github.com/rodluger/starry_process'>starry process</a> is extremely fast.</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Figure1" class="blog-image full-width">
                    <a href="#" data-toggle="modal" data-target="#Figure1Modal">
                        
                <div class="blog-image-container full-width">
                <video width='100%' autoplay muted loop>
                    <source src='images/starry-process.mp4' type='video/mp4'>
                    Your browser does not support the video tag.
                </video>
                </div>
                    </a>
                    <p>
                        <span style="font-weight: 600; padding-right: 0.5em;">Figure 1</span>
                        <span>A video demo of a <a href='https://github.com/rodluger/starry_process'>starry process</a>. The kernel of the Gaussian process is a function of six hyperparameters that control the mean and standard deviation of the spot size, latitude, and contrast distributions (top panels). The bottom panels show random samples from the GP on the surface of the star (in a Mollweide projection) and in flux space. Line colors correspond to different stellar inclinations with respect to the line of sight. Because the kernel is an analytic function of the hyperparameters, drawing samples and computing marginal likelihoods with a <a href='https://github.com/rodluger/starry_process'>starry process</a> is extremely fast.</span>
                    </p>
                </div>
                <p>The kernel of the GP is a function of six parameters: the mean and standard deviation of the spot latitude distribution (in degrees; top left), the mean and standard deviation of the spot size distribution (also in degrees; top center), and the mean and standard deviation of the spot contrast (measured as a fraction of the photospheric intensity; top right). Below the distribution are five random samples from the GP, visualized on the surface of the star in an equal-area Mollweide projection. Below each are the corresponding light curves assuming different viewing inclinations ranging from 15&deg; (yellow) to 90&deg (dark red). In the video, everything is computed in real time as the GP parameters are adjusted: because the <span style='font-style:italic;'>starry process</span> is analytic, it is extremely fast to evaluate.</p><p>The demo above is of course just a video. I'm hoping to turn it into a proper web app in the near future, but for the time being it has to be run locally. If you want to play around with it yourself, you can install the (very experimental) beta version as follows:</p><p><pre><code class='bash'>pip install "git+git://github.com/rodluger/starry_process.git@blog#egg=starry_process[app]"</code></pre></p><p>then, in the command line, type</p><p><pre><code class='bash'>starry-process</code></pre></p><p>to launch the Bokeh app.</p><p><h1>What you can do with a starry process</h1></p><p>Again, let's delay for the time being discussing how the GP works and briefly talk about <span style='font-style:italic;'>what</span> the GP can do. I mentioned in the <a href='2020-09-24.html'>previous post</a> that an interpretable GP can be used within a hierarchical model to learn about ensemble statistics of many light curves. To recap, the idea behind this is that any individual light curve contains only a small fraction of the information about what the surface of the star looks like (because of all the degeneracies that come with projecting a two-dimensional surface down to a one-dimensional flux timeseries). However, these degeneracies are inclination-dependent, so different stars will have different degeneracies. The trick is to realize that if we collect light curves of many <span style='font-style:italic;'>similar</span> stars, we can learn more about the population than we can for any individual star. Here, <span style='font-style:italic;'>similar</span> is loosely defined: we simply want stars whose properties are drawn from the same parent distribution (individual stars may still look quite different!) To show how we can do this using a <span style='font-style:italic;'>starry process</span>, let's create a toy dataset:</p>
                <div id="Figure2Modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body full-width">
                                
                <div class="blog-image-container full-width">
                    <img src='images/starry-process-synthetic-data.jpg' style='width:100%;'></img>
                </div>
                
                                <p>
                                    <span style="font-weight: 600; padding-right: 0.5em;">Figure 2</span>
                                    <span>A synthetic dataset consisting of ten light curves of stars with similar star spot properties. The surface maps were generated by placing 20 discrete circular spots at latitudes and with sizes and contrasts drawn from fiducial Gaussian distributions. The light curves were then computed by expanding the surface in spherical harmonics to high degree (30) and using <a href='https://github.com/rodluger/starry'>starry</a> to compute fluxes. Each star was given a random inclination drawn from a \(\sin i\) prior; the \( \times \) on each map marks the sub-observer point. Finally, a small amount of noise was added to each light curve to simulate photon noise.</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Figure2" class="blog-image full-width">
                    <a href="#" data-toggle="modal" data-target="#Figure2Modal">
                        
                <div class="blog-image-container full-width">
                    <img src='images/starry-process-synthetic-data.jpg' style='width:100%;'></img>
                </div>
                
                    </a>
                    <p>
                        <span style="font-weight: 600; padding-right: 0.5em;">Figure 2</span>
                        <span>A synthetic dataset consisting of ten light curves of stars with similar star spot properties. The surface maps were generated by placing 20 discrete circular spots at latitudes and with sizes and contrasts drawn from fiducial Gaussian distributions. The light curves were then computed by expanding the surface in spherical harmonics to high degree (30) and using <a href='https://github.com/rodluger/starry'>starry</a> to compute fluxes. Each star was given a random inclination drawn from a \(\sin i\) prior; the \( \times \) on each map marks the sub-observer point. Finally, a small amount of noise was added to each light curve to simulate photon noise.</span>
                    </p>
                </div>
                <p>The figure above shows a dataset comprised of ten light curves of stars with statistically similar star spot properties. I generated it by choosing fiducial values for the mean and variance of the (Gaussian) distributions for the spot size, latitude, and contrast, then drawing 20 spots from these distributions for each star. The spots are circular and the contrast is uniform within each one (as we will see below, this is quite different from the prescription used to compute the GP; this is extremely important, since we don't want our proof that the GP works to be circular!) I then gave each star a random inclination, drawn from the expected \(\sin i\) prior for inclination angles, and computed the "observed" light curve using <a href='https://github.com/rodluger/starry'>starry</a>.</p><p>Now, we pretend we merely observe these light curves, and that we have absolutely no knowledge of the number of spots, the spot sizes, positions, and contrasts, or the inclination of any of the stars. (For simplicity, we'll assume we know the rotational period exactly, although this could easily be sampled over as well). The only thing we'll assume is that these stars are "similar": that is, there is some parent distribution from which all these stellar surfaces were drawn. In practice, this might mean the stars have the same spectral type, similar ages (or rotation periods), and similar metallicities. What we therefore do is to place uninformative priors on all of these quantities and use the sampler of our choice to explore their posteriors. Our likelihood function is the usual GP likelihood (see <a href='2020-09-24.html#GPLikelihood'>this equation</a>), although this time our GP kernel is an explicit function of the parameters we care about. <a href='#Figure3'>Figure 3</a> below shows the posterior distributions for some of the quantities of interest from a Variational Inference (VI) scheme:</p>
                <div id="Figure3Modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body full-width medium">
                                
                <div class="blog-image-container full-width medium">
                    <img src='images/starry-process-posteriors.jpg' style='width:100%;'></img>
                </div>
                
                                <p>
                                    <span style="font-weight: 600; padding-right: 0.5em;">Figure 3</span>
                                    <span>Joint posterior distributions for the hyperparameters governing the spot latitude and contrast distributions, inferred by jointly analyzing the ten light curves in <a href='#Figure2'>Figure 2</a>. Uniform priors were assumed for all hyperparameters of the GP. The inclinations of each star were also treated as latent variables (see <a href='#Figure4'>Figure 4</a>). The blue lines indicate the true values used to generate the synthetic dataset; note the excellent agreement with the inferred values.</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Figure3" class="blog-image full-width medium">
                    <a href="#" data-toggle="modal" data-target="#Figure3Modal">
                        
                <div class="blog-image-container full-width medium">
                    <img src='images/starry-process-posteriors.jpg' style='width:100%;'></img>
                </div>
                
                    </a>
                    <p>
                        <span style="font-weight: 600; padding-right: 0.5em;">Figure 3</span>
                        <span>Joint posterior distributions for the hyperparameters governing the spot latitude and contrast distributions, inferred by jointly analyzing the ten light curves in <a href='#Figure2'>Figure 2</a>. Uniform priors were assumed for all hyperparameters of the GP. The inclinations of each star were also treated as latent variables (see <a href='#Figure4'>Figure 4</a>). The blue lines indicate the true values used to generate the synthetic dataset; note the excellent agreement with the inferred values.</span>
                    </p>
                </div>
                <p>As you can tell from the figure, we were able to accurately infer the mean latitude of the spots, the scatter (variance) in the latitude, and the typical contrast of the spots in our ensemble of ten stars. Below, <a href='#Figure4'>Figure 4</a> shows the posterior distributions for the inclinations of each of the stars:</p>
                <div id="Figure4Modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body full-width">
                                
                <div class="blog-image-container full-width">
                    <img src='images/starry-process-inclination-posteriors.jpg' style='width:100%;'></img>
                </div>
                
                                <p>
                                    <span style="font-weight: 600; padding-right: 0.5em;">Figure 4</span>
                                    <span>Posterior distributions for the inclinations of each of the ten stars in <a href='#Figure1'>Figure 1</a>. A \(\sin i\) prior was placed on each one. Stellar inclinations are notoriously difficult to infer from light curves given all the degeneracies in the mapping problem. However, ensemble analysis of similar stars allows one to infer these inclinations with fairly high precision and minimal bias.</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Figure4" class="blog-image full-width">
                    <a href="#" data-toggle="modal" data-target="#Figure4Modal">
                        
                <div class="blog-image-container full-width">
                    <img src='images/starry-process-inclination-posteriors.jpg' style='width:100%;'></img>
                </div>
                
                    </a>
                    <p>
                        <span style="font-weight: 600; padding-right: 0.5em;">Figure 4</span>
                        <span>Posterior distributions for the inclinations of each of the ten stars in <a href='#Figure1'>Figure 1</a>. A \(\sin i\) prior was placed on each one. Stellar inclinations are notoriously difficult to infer from light curves given all the degeneracies in the mapping problem. However, ensemble analysis of similar stars allows one to infer these inclinations with fairly high precision and minimal bias.</span>
                    </p>
                </div>
                <p>Even though we assumed a completely uninformative inclination prior, we were able to infer the inclinations for all the stars in our sample with fairly good precision and minimal bias(!) This is something that is just not possible to do for a single star from its light curve, since the inclination is highly degenerate with the spot contrast, the number of spots, etc. This is the power of population-level analyses: the joint information content of lots of members allows us to learn not only population-level information (the typical latitude and contrast of the spots) but it also helps uncover information specific to individual members.</p><p><h1>How it all works</h1></p><p>Coming soon!</p>
                              </div>

                              <div class="blog-author">
                                   <div class="media">
                                        <div class="media-object pull-left">
                                             <img src="../images/rodrigo-luger-avatar.jpg" class="img-circle img-responsive"
                                                  alt="Rodrigo Luger">
                                        </div>
                                        <div class="media-body">
                                             <h3 class="media-heading"><a
                                                       href="../about.html">Rodrigo Luger</a>
                                             </h3>
                                             <p style="text-align:justify;">
                                                  I'm a Flatiron Fellow at the CCA in New York City, working on a variety of things related to exoplanets, stars, and astronomical data analysis. I'm interested in systematics de-trending, the search for and characterization of potentially habitable exoplanets, and the mapping of stellar and exoplanetary surfaces from photometric and spectroscopic datasets. Outside the office I love to hike, bike, swim, craft lattes, faulty parallelism, and Oxford commas.
                                             </p>
                                        </div>
                                   </div>
                              </div>

                              <div class="disqus" id="disqus_thread"></div>

                         </div>
                    </div>
               </div>
          
          </div>
     </section>

     

     <!-- Footer Section -->

     <footer>
          <div class="container">
               <div class="row">

                    <div class="col-md-3 col-sm-3">
                         <span class="avatar">
                              <img src="../images/rodrigo-luger-avatar.jpg">
                         </span>
                    </div>

                    <div class="col-md-4 col-sm-4">
                         <p>162 5th Ave, 5th Floor<br />New York NY 10100 United States</p>
                    </div>

                    <div class="col-md-offset-1 col-md-4 col-sm-offset-1 col-sm-3">
                         <p><a href="mailto:rodluger@gmail.com">rodluger@gmail.com</a> <br /> (610) 675 6056</p>
                    </div>

                    <div class="clearfix col-md-12 col-sm-12">
                         <hr>
                    </div>

                    <div class="col-md-6 col-sm-6">
                         <div class="footer-copyright">
                              <p>© 2020 Rodrigo Luger &nbsp | &nbsp <a
                                        href="https://github.com/rodluger/rodluger.github.io">hosted on github</a>
                              </p>
                         </div>
                    </div>

                    <div class="col-md-6 col-sm-6">
                         <ul class="social-icon">
                              <li><a href="https://github.com/rodluger" class="fab fa-github"></a></li>
                              <li><a href="https://twitter.com/rodluger" class="fab fa-twitter"></a></li>
                              
                         </ul>
                    </div>

               </div>
          </div>
     </footer>

     <!-- SCRIPTS -->

     <script src="../js/jquery.js"></script>
     <script src="../js/bootstrap.min.js"></script>
     <script src="../js/custom.js"></script>

</body>

</html>